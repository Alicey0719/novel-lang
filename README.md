# Novel-Lang

## コンセプト

美少女ノベルゲームの世界観を表現した言語。  
ゲームのシナリオデータやゲーム画面・世界観を表現しつつ記述できる言語である。

## 構文ルール
<!-- 参考: ハミダシクリエイティブ シナリオデータ -->
-   文列:
    -   `文 (文)*` (よくわかってない)
-   文:
    -   代入
    -   分岐
    -   繰り返し
    -   出力
    -   分列
-   代入文:
    -   `【変数】（式）`  
        ※ （）は全角丸括弧
-   条件分岐:
    -   `🤔式……文(真)……文(偽)`  
        ※「……」は U+2026 を 2 つ (echo -e "\u2026\u2026")
        <!-- 美少ゲーテキストで多用される「……」 -->
-   繰り返し:
    -   `🕑式……文`  
        ※「……」は U+2026 を 2 つ (echo -e "\u2026\u2026")
        <!-- できない私が繰り返すから時計 -->
-   STD入力
    - `📝`
    - 数値・文字列両対応(入力値が数値のみかどうかで判定)
-   STD出力:
    -   `「式」`
-   式(exp):
    -   `calcの式準拠`
    -   不等号比較もほしい
-   項(term):
    -   `因子 (( ‘*’ | ‘/’ ) 因子)*` (Calc 準拠)
-   因子(fact):
    -   `リテラル | 【変数】 | ‘(‘ 式 ‘)’` (Calc 準拠)
-   文字列
    -   `⛄文字列⛄`
-   終了
    - `Ex-iT`
    <!-- exit-soft から -->


## 拡張子
- `{filename}.nl`
- `{filename}.凸`

## 注意

-   絵文字がちゃんと出力されるターミナルと、うまく出力できないターミナルがある。  
    (VSCode, WindowsTerminal, Terminal(Mac) は問題なし。コマンドプロンプト, PowerShell, Termius はだめ。)

## こんな感じ？

### 例 1

```
【華乃】（131）
【天梨】（317）
🤔　【華乃】>【天梨】……【答え】（【華乃】-【天梨】）……【答え】（【天梨】-【華乃】）
「【答え】」
```

> 186

## 内部仕様

### メンバ変数
- `@@KEYS`
    - 言語で予約しているキーワードの対応ハッシュ
- `@@XXXX_RE`
    - 正規表現の定数(String)
- `@nl_var_hash`
    - 言語内で定義した変数名と値を保管するハッシュ
- `@debug`
    - DebugモードのON/OFFを定義する変数
- `@sc`
    - パースに使う`StringScanner`
- `@before_scan`
    - `StringScanner` が `eos` で `unscan` できないときのために前回のscan結果を保持する変数

### メソッド
-   `sentences()`  
    -   複数の `sentence` をブロックとしてまとめ `eval` で実行できる配列にする
-   `sentence()`  
    -   プログラム中から実行する処理を探し `sentence` として返却するメソッド
-   `loopers()`  
    -   プログラム中からループ処理 `⌚` を解釈するメソッド。ループを実行する命令を配列に格納する
-   `branch()`  
    -   プログラム中から条件分岐 `🤔` を解釈するメソッド。条件分岐する命令を配列に格納する
-   `std_out()`  
    -   プログラム中から標準出力処理 `「」` を解釈するメソッド。標準出力する命令を配列に格納する
-   `assignment()`  
    -   プログラム中から変数に式・標準入力・文字列を代入する処理 `（）` を解釈するメソッド。代入する命令を配列に格納する
-   `eop()`  
    -   プログラムが末尾に来た際に実行するメソッド。プログラムを終了する命令を配列に格納する
-   `ex_it()`  
    -   プログラム中から終了処理 `Ex-iT` を解釈するメソッド。プログラムを終了する命令を配列に格納する
-   `eval()`  
    -   構文解析結果の配列から処理を実行するメソッド
-   `expression()`  
    -   式を定義するメソッド
-   `term()`  
    -   項を定義するメソッド
-   `factor()`  
    -   因子を定義するメソッド
-   `get_token()`  
    -   `@code` の戦闘からトークンを一つ切り出して返す。パーサー(群)から呼び出される。
-   `unget_token()`  
    -   StringScannerの状態を `get_token()` 実行前に戻す
-   `is_number?()`  
    -   渡された文字列が数値のみで構成されていた場合、Trueを返す
-   `str_is_exception()`      
    -   Stringのデータが渡された際に例外を発生させる
-   `read_file()`  
    -   ソースコードなどのテキストデータを読み込み、文字列を返却する
-   `escape()`  
    -   プログラムを終了する